@{
    ViewData["Title"] = "Boletería";
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewData["Title"]</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
    <div class="container my-4">
        <h1 class="text-center">Boletería</h1>

        <!-- Resumen de totales -->
        <div class="my-4 text-center">
            <p><strong>Total Tiquetes Vendidos:</strong> @ViewBag.TotalTiquetes</p>
            <p><strong>Total Dinero Recaudado:</strong> @ViewBag.TotalDinero colones</p>
        </div>

        <!-- Formulario para ingresar datos de la compra -->
        <form asp-action="ImprimirTiquete" method="get" class="p-4 bg-light border rounded">
            <h3 class="text-center mb-4">Generar Tiquete</h3>

            <!-- Selección de ruta -->
            <div class="mb-3">
                <label for="ruta" class="form-label">Ruta</label>
                <select id="ruta" name="ruta" class="form-select" required>
                    <option value="">Seleccione una ruta</option>
                    <option value="Siquirres-La Alegría">Siquirres-La Alegría</option>
                    <option value="Otra Ruta">Otra Ruta</option>
                </select>
            </div>

            <!-- Subrutas dinámicas -->
            <div class="mb-3">
                <label for="subRuta" class="form-label">SubRuta</label>
                <select id="subRuta" name="subRuta" class="form-select" required>
                    <option value="">Seleccione una subruta</option>
                    <option value="Cairo M">Cairo</option>
                    <option value="Herediana">Herediana</option>
                    <option value="7:10 AM">7:10 AM</option>
                    <option value="8:10 AM">8:10 AM</option>
                    <option value="9:10 AM">9:10 AM</option>
                    <option value="10:10 AM">10:10 AM</option>
                    <option value="11:10 AM">11:10 AM</option>
                    <option value="12:10 PM">12:10 PM</option>
                    <option value="1:10 PM">1:10 PM</option>
                    <option value="2:10 PM">2:10 PM</option>
                    <option value="3:10 PM">3:10 PM</option>
                    <option value="4:10 PM">4:10 PM</option>
                    <option value="5:10 PM">5:10 PM</option>
                    <option value="6:00 PM">6:00 PM</option>
                    <option value="6:45 PM">6:45 PM</option>
                    <option value="7:30 PM">7:30 PM</option>
                </select>
            </div>

            <!-- Horario -->
            <div class="mb-3">
                <label for="horario" class="form-label">Horario</label>
                <select id="horario" name="horario" class="form-select" required>
                    <option value="5:30 AM">5:30 AM</option>
                    <option value="6:10 AM">6:10 AM</option>
                    <option value="7:10 AM">7:10 AM</option>
                    <option value="8:10 AM">8:10 AM</option>
                    <option value="9:10 AM">9:10 AM</option>
                    <option value="10:10 AM">10:10 AM</option>
                    <option value="11:10 AM">11:10 AM</option>
                    <option value="12:10 PM">12:10 PM</option>
                    <option value="1:10 PM">1:10 PM</option>
                    <option value="2:10 PM">2:10 PM</option>
                    <option value="3:10 PM">3:10 PM</option>
                    <option value="4:10 PM">4:10 PM</option>
                    <option value="5:10 PM">5:10 PM</option>
                    <option value="6:00 PM">6:00 PM</option>
                    <option value="6:45 PM">6:45 PM</option>
                    <option value="7:30 PM">7:30 PM</option>
                </select>
            </div>

            <!-- Cantidad de tiquetes -->
            <div class="mb-3">
                <label for="cantidad" class="form-label">Cantidad de Tiquetes</label>
                <input type="number" id="cantidad" name="cantidad" class="form-control" placeholder="Ingrese la cantidad" min="1" required>
            </div>

            <!-- Botón de imprimir -->
            <div class="text-center">
                <button type="submit" class="btn btn-primary">Vista previa e Imprimir</button>
            </div>
        </form>
    </div>

    <!-- Script para manejar subrutas dinámicas -->
    <script>
        document.getElementById('ruta').addEventListener('change', function () {
            const rutaSeleccionada = this.value;
            const subRutaSelect = document.getElementById('subRuta');

            // Limpiar opciones existentes
            subRutaSelect.innerHTML = '<option value="">Seleccione una subruta</option>';

            if (rutaSeleccionada) {
                fetch(`/Boleteria/GetSubRutas?ruta=${rutaSeleccionada}`)
                    .then(response => response.json())
                    .then(data => {
                        data.forEach(item => {
                            const option = document.createElement('option');
                            option.value = item.SubRuta;
                            option.textContent = `${item.SubRuta} - ${item.Precio} colones`;
                            subRutaSelect.appendChild(option);
                        });
                    })
                    .catch(error => console.error('Error al cargar las subrutas:', error));
            }
        });
    </script>

    <!-- SweetAlert para mensajes -->
    <script>
        @if (TempData["SuccessMessage"] != null)
        {
            <text>
                Swal.fire({
                    icon: 'success',
                    title: '¡Éxito!',
                    text: '@TempData["SuccessMessage"]',
                    confirmButtonText: 'Aceptar'
                });
            </text>
        }

        @if (TempData["ErrorMessage"] != null)
        {
            <text>
                Swal.fire({
                    icon: 'error',
                    title: '¡Error!',
                    text: '@TempData["ErrorMessage"]',
                    confirmButtonText: 'Aceptar'
                });
            </text>
        }
    </script>

    <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
